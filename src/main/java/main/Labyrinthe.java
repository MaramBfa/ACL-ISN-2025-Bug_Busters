package main;

import simple.Position;
import simple.Level;
import java.util.*;

public class Labyrinthe {
    private final int width;
    private final int height;
    private final char[][] grille;
    private final Random rand = new Random();

    // Grille fixe pr√©d√©finie
    private static final char[][] LEVEL1 = {
            {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
            {'#',' ',' ',' ','#',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
            {'#',' ','#',' ','#',' ','#','#','#','#','#',' ','#',' ','#'},
            {'#',' ','#',' ',' ',' ',' ',' ',' ',' ','#',' ','#',' ','#'},
            {'#',' ','#','#','#','#','#','#','#',' ','#','D',' ',' ','#'},
            {'#',' ',' ',' ',' ',' ',' ','#',' ',' ',' ',' ','#',' ','#'},
            {'#','#','#','#','#','#',' ','#','K','#','#','#',' ','#','#'},
            {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
            {'#',' ','#','#','#','#','#','#','#','#','#',' ',' ',' ','#'},
            {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#',' ','#'},
            {'#','#','#','#','#',' ','#','#','#','#','#',' ','#','#','#'},
            {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
            {'#',' ','#','#','#','#','#','#','#','#','#','#','#',' ','#'},
            {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
            {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}
        };

        private static final char[][] LEVEL2 = {
        		{'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
                {'#',' ',' ',' ','#',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#',' ','#',' ','#','#','#','#','#',' ','#',' ','#'},
                {'#',' ','#',' ',' ',' ',' ',' ',' ',' ','#',' ','#',' ','#'},
                {'#',' ','#','#','#','#','#','#','#',' ','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ','#',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#','#',' ','#','K','#','#','#',' ','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#',' ',' ',' ','#'},
                {'#','D',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#',' ','#','#','#','#','#',' ','#','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#','#','#',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}
            };
        private static final char[][] LEVEL3 = {
        		{'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
                {'#',' ',' ',' ','#',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#',' ',' ',' ','#','#','#','#','#',' ','#',' ','#'},
                {'#',' ','#',' ',' ',' ',' ',' ',' ',' ','#',' ','#',' ','#'},
                {'#',' ','#','#','#','#','#','#','#',' ','#','D',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ','#',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#','#',' ','#',' ','#','#',' ',' ','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#',' ','#','#','#','#','#',' ','#','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#','K','#','#','#','#','#','#','#','#','#','#','#',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}
            };
        private static final char[][] LEVEL4 = {
        		{'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
                {'#','K',' ',' ','#',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#',' ','#',' ','#','#','#','#','#',' ','#',' ','#'},
                {'#',' ','#',' ',' ',' ',' ',' ',' ',' ','#',' ','#',' ','#'},
                {'#',' ','#','#','#','#','#','#','#',' ','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ','#',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#','#',' ','#',' ','#','#','#',' ','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#','D','#','#','#','#','#',' ','#','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#','#','#',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}
            };
        private static final char[][] LEVEL5 = {
        		{'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
                {'#',' ',' ',' ','#','D',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#',' ','#','#','#',' ','#','#','#',' ','#',' ','#'},
                {'#',' ','#',' ',' ',' ',' ',' ',' ',' ','#',' ','#',' ','#'},
                {'#',' ',' ',' ','#','#','#','#','#',' ','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ','#',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#','#',' ','#','K','#','#','#',' ','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#',' ','#','#','#','#','#',' ','#','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#','#','#',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}
            };
        private static final char[][] LEVEL6 = {
        		{'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
                {'#',' ',' ',' ','#',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#',' ','#',' ','#','#','#','#','#',' ','#',' ','#'},
                {'#',' ','#',' ',' ',' ',' ',' ',' ',' ','#',' ','#',' ','#'},
                {'#',' ','#','#','#','#','#','#','#',' ','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ','#',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#','#',' ','#','K','#','#','#',' ','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#',' ','#','#','#','#','#',' ','#','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#','#','#',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','D','#'},
                {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}
            };
        private static final char[][] LEVEL7 = {
        		{'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
                {'#',' ',' ',' ','#',' ',' ',' ',' ',' ',' ',' ',' ','D','#'},
                {'#',' ','#','#','#',' ','#','#','#','#','#',' ','#',' ','#'},
                {'#',' ','#',' ',' ',' ',' ',' ',' ',' ','#',' ','#',' ','#'},
                {'#',' ','#','#','#','#','#','#','#',' ','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ','#',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#','#',' ',' ','K','#','#','#',' ','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#','#','#','#','#','#','#',' ','#','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#','#','#',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}
            };
        private static final char[][] LEVEL8 = {
        		{'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
                {'#',' ',' ',' ','#',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#',' ','#',' ','#','#','#','#','#',' ','#',' ','#'},
                {'#',' ','#',' ',' ',' ',' ',' ',' ',' ','#',' ','#',' ','#'},
                {'#',' ','#','#','#','#','#','#','#',' ','#','D',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ','#',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#','#',' ','#','K','#','#','#',' ','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#',' ','#','#','#','#','#',' ','#','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#','#','#',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}
            };

        private static final char[][] LEVEL9 = {
        		{'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
                {'#',' ',' ',' ','#',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#',' ','#',' ','#','#','#','#','#',' ','#',' ','#'},
                {'#',' ','#',' ',' ',' ',' ',' ',' ',' ','#',' ','#',' ','#'},
                {'#',' ','#','#','#','#','#','#','#',' ','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ','#',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#','#',' ','#','K','#','#','#',' ','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#',' ','#','#','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#',' ','#','#','#','#','#',' ','#','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','D','#','#','#','#','#','#','#','#',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}
            };
        private static final char[][] LEVEL10 = {
        		{'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
                {'#',' ',' ',' ','#',' ',' ',' ',' ',' ',' ',' ','#',' ','#'},
                {'#',' ','#',' ','#',' ','#','#','#','#','#',' ','#',' ','#'},
                {'#',' ','#',' ',' ',' ',' ',' ',' ',' ','#',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#',' ','#','#',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ','#',' ',' ',' ',' ','#',' ','#'},
                {'#','K','#','#','#','#',' ','#','D','#','#','#',' ','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#',' ',' ',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#',' ','#'},
                {'#','#','#','#','#',' ','#','#','#','#','#',' ','#','#','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#',' ','#','#','#','#','#','#','#','#','#','#','#',' ','#'},
                {'#',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
                {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}
            };




        public Labyrinthe(Level level) {
            char[][] selectedGrid;

            switch (level.id) {
                case 1: selectedGrid = LEVEL1; break;
                case 2: selectedGrid = LEVEL2; break;
                case 3: selectedGrid = LEVEL3; break;
                case 4: selectedGrid = LEVEL4; break;
                case 5: selectedGrid = LEVEL5; break;
                case 6: selectedGrid = LEVEL6; break;
                case 7: selectedGrid = LEVEL7; break;
                case 8: selectedGrid = LEVEL8; break;
                case 9: selectedGrid = LEVEL9; break;
                case 10: selectedGrid = LEVEL10; break;
                default: selectedGrid = LEVEL1; // fallback si jamais id est invalide
            }


            this.height = selectedGrid.length;
            this.width = selectedGrid[0].length;
            this.grille = new char[height][width];

            for (int i = 0; i < height; i++) {
                System.arraycopy(selectedGrid[i], 0, grille[i], 0, width);
            }
        }

     public char[][] getGrille() {
            return grille;
        }

        // üîé Affichage console
     public void printGrille() {
            for (int i = 0; i < height; i++) {
                for (int j = 0; j < width; j++) {
                    System.out.print(grille[i][j]);
                }
                System.out.println();
            }
        }

    // Compter les murs
    private int compterMurs() {
        int count = 0;
        for (int i = 0; i < height; i++) {
            for (int j = 0; j < width; j++) {
                if (grille[i][j] == '#') count++;
            }
        }
        return count;
    }

    // Compter les sols
    private int compterSols() {
        int count = 0;
        for (int i = 1; i < height - 1; i++) {
            for (int j = 1; j < width - 1; j++) {
                if (grille[i][j] == ' ') count++;
            }
        }
        return count;
    }

    // Trouver les zones accessibles depuis une position donn√©e
    public Set<Position> trouverZonesAccessibles(Position startPos) {
        Set<Position> accessible = new HashSet<>();
        Queue<Position> queue = new LinkedList<>();

        if (startPos.x < 0 || startPos.x >= height || startPos.y < 0 || startPos.y >= width || grille[startPos.x][startPos.y] == '#') {
            return accessible;
        }

        queue.add(startPos);
        accessible.add(startPos);

        int[] dr = {-1, 1, 0, 0};
        int[] dc = {0, 0, -1, 1};

        while (!queue.isEmpty()) {
            Position current = queue.poll();

            for (int i = 0; i < 4; i++) {
                int newR = current.x + dr[i];
                int newC = current.y + dc[i];

                if (newR >= 0 && newR < height && newC >= 0 && newC < width) {
                    Position neighbor = new Position(newR, newC);

                    if (grille[newR][newC] != '#' && !accessible.contains(neighbor)) {
                        accessible.add(neighbor);
                        queue.add(neighbor);
                    }
                }
            }
        }
        return accessible;
    }

    // Placer une entit√© sur une case accessible et libre
    public Position placerAccessible(Set<Position> occupees, Set<Position> accessibles) {
        List<Position> candidates = new ArrayList<>();

        for (Position p : accessibles) {
            if (!occupees.contains(p)) {
                candidates.add(p);
            }
        }

        if (candidates.isEmpty()) {
            // Fallback : chercher n'importe quelle position libre
            for (int r = 1; r < height - 1; r++) {
                for (int c = 1; c < width - 1; c++) {
                    if (grille[r][c] == ' ') {
                        Position pos = new Position(r, c);
                        if (!occupees.contains(pos)) {
                            occupees.add(pos);
                            return pos;
                        }
                    }
                }
            }
            // Dernier recours : position al√©atoire
            int x, y;
            do {
                x = rand.nextInt(height - 2) + 1;
                y = rand.nextInt(width - 2) + 1;
            } while (grille[x][y] == '#' || occupees.contains(new Position(x, y)));
            Position pos = new Position(x, y);
            occupees.add(pos);
            return pos;
        }

        Position selectedPos = candidates.get(rand.nextInt(candidates.size()));
        occupees.add(selectedPos);
        return selectedPos;
    }

    // Placer une entit√© loin d'une position donn√©e
    public Position placerLoinDe(Position refPos) {
        List<Position> candidates = new ArrayList<>();
        int maxDistance = -1;

        for (int r = 1; r < height - 1; r++) {
            for (int c = 1; c < width - 1; c++) {
                if (grille[r][c] == ' ') {
                    Position currentPos = new Position(r, c);
                    int distance = Math.abs(r - refPos.x) + Math.abs(c - refPos.y);

                    if (distance > maxDistance) {
                        maxDistance = distance;
                        candidates.clear();
                        candidates.add(currentPos);
                    } else if (distance == maxDistance) {
                        candidates.add(currentPos);
                    }
                }
            }
        }

        if (candidates.isEmpty()) {
            return new Position(height - 2, width - 2);
        }

        return candidates.get(rand.nextInt(candidates.size()));
    }
}
